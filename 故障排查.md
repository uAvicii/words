# 故障排查指南

## 问题：注册时提示 "Unexpected end of JSON input"

### 原因分析
这个错误通常由以下原因导致：
1. **后端服务器未启动** - 前端无法连接到后端
2. **端口被占用** - 3000 端口已被其他程序使用
3. **CORS 配置问题** - 跨域请求被阻止
4. **网络请求失败** - fetch 请求返回空响应

### 解决步骤

#### 步骤 1: 确认后端服务器已启动

**方法 1: 使用测试脚本（推荐）**
```bash
test-server.bat
```

**方法 2: 手动启动**
```bash
cd server
npm install
node server.js
```

**成功标志：**
应该看到：
```
🚀 服务器运行在 http://localhost:3000
```

#### 步骤 2: 测试后端 API

在浏览器中访问：
```
http://localhost:3000/api/login
```

或使用 curl：
```bash
curl -X POST http://localhost:3000/api/login ^
  -H "Content-Type: application/json" ^
  -d "{\"username\":\"test\",\"password\":\"123456\"}"
```

**预期结果：**
应该返回 JSON 数据，例如：
```json
{
  "success": true,
  "message": "注册成功",
  "username": "test",
  "words": []
}
```

#### 步骤 3: 检查端口占用

如果 3000 端口被占用，查找占用进程：
```bash
netstat -ano | findstr :3000
```

结束占用进程：
```bash
taskkill /PID <进程ID> /F
```

或者修改后端端口（在 `server/server.js` 中）：
```javascript
const PORT = 3001  // 改为其他端口
```

同时修改前端配置（在 `src/stores/userStore.js` 和 `src/stores/wordStore.js` 中）：
```javascript
const API_BASE = 'http://localhost:3001/api'
```

#### 步骤 4: 完整重启

1. **关闭所有窗口**
   - 关闭所有终端窗口
   - 关闭浏览器标签页

2. **清理缓存**
   - 删除 `server/node_modules` 文件夹
   - 在浏览器中清除网站数据

3. **重新启动**
   ```bash
   # 终端 1 - 启动后端
   cd server
   npm install
   npm start

   # 终端 2 - 启动前端（等后端启动后）
   npm run dev
   ```

4. **访问应用**
   - 打开 http://localhost:5173
   - 输入用户名和密码
   - 点击登录/注册

## 常见错误及解决方案

### 错误 1: "无法连接到服务器"
**原因:** 后端未启动
**解决:** 先启动后端 `npm run server`

### 错误 2: "服务器返回格式错误"
**原因:** 后端返回的不是 JSON
**解决:** 检查后端是否正常运行，查看终端错误日志

### 错误 3: "密码错误"
**原因:** 用户已存在但密码不匹配
**解决:** 使用正确的密码，或删除 `server/data/users.json` 重新注册

### 错误 4: CORS 错误
**原因:** 跨域配置问题
**解决:** 确保 `server/server.js` 中有 `app.use(cors())`

## 检查清单

- [ ] 后端服务器正在运行（终端显示 "服务器运行在 http://localhost:3000"）
- [ ] 前端应用正在运行（访问 http://localhost:5173）
- [ ] 浏览器控制台没有网络错误（按 F12 查看）
- [ ] `server/data/users.json` 文件存在且格式正确
- [ ] 端口 3000 和 5173 没有被占用

## 查看日志

### 后端日志
后端终端会显示所有请求和错误：
```
POST /api/login 200 - 15ms
```

### 前端日志
浏览器控制台（F12）会显示网络请求：
```
Network → 查看 /api/login 请求
Console → 查看错误信息
```

## 数据文件位置

- **后端数据:** `server/data/users.json`
- **前端缓存:** 浏览器 LocalStorage
  - F12 → Application → Local Storage → http://localhost:5173

## 重置所有数据

如果需要完全重置：

1. **删除后端数据**
   ```bash
   del server\data\users.json
   ```

2. **清除浏览器缓存**
   - F12 → Application → Storage → Clear site data

3. **重启服务**
   ```bash
   # 重新启动后端和前端
   ```

## 仍然无法解决？

请检查：
1. Node.js 版本 >= 16
   ```bash
   node --version
   ```

2. 网络连接正常

3. 防火墙未阻止本地端口

4. 提供完整的错误信息截图以获取帮助

